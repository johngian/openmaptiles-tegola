# Tegola & OpenMaptiles

## About

This project is aiming to enable the tegola vector tile server to support
serving tiles using the OpenMapTiles schema.

## Installation

### Requirements

- [docker]
- [docker-compose]

### Quickstart

#### Init

Fetch git submodules:

```bash
$ git clone https://github.com/johngian/openmaptiles-tegola.git
$ git submodule update --init
```

#### Build openmaptiles-tools

```bash
$ cd vendor/openmaptiles-tools
$ make build-docker VERSION="tegola-dev"
```

#### Configure tegola server

```bash
$ export TOOLS_VERSION="tegola-dev"
$ cd vendor/openmaptiles
$ make start-db
$ make list-geofabrik      # List all areas available to download
$ make download area=planet   # Planet takes long time to load. Use a different area for dev purposes
$ make import-osm
$ make import-borders
$ make import-wikidata
$ make build-tegola-config
$ cat build/tegola.toml
```

#### Start tegola server

```bash
$ cd vendor/openmaptiles
$ docker-compose up tegola
```

## Notes

- Currently the setup is relying on the following forks
  - [johngian/openmaptiles-tools@tegola-config](https://github.com/johngian/openmaptiles-tools/tree/tegola-config)
    - Implemented an openmaptile-tool to generate the tegola config
  - [johngian/openmaptiles@tegola-support](https://github.com/johngian/openmaptiles/tree/tegola-support)
    - Added tegola support in the docker-compose setup
    - Added some extra makefile targets to make the bootstrapping process easier
  - [johngian/tegola@mvt-fixes](https://github.com/johngian/tegola/tree/mvt-fixes)
    - Fixed some issues encountered while parsing the MVT SQL generated by openmaptiles

## State

- Currently this is a proof of concept to assess if tegola can serve OpenMapTiles
- For convenience, I based all the work on the submodule forks. If there is interest the patches can be upstreamed
- I manually tested all the process end-to-end and it looks like everything is working as expected
  - `openmaptiles-tools` generates a valid configuration
  - `openmaptiles` bootstrapping process spawns a tegola server
  - `tegola` serves tiles based on OpenMapTiles

As a more tangible test, I managed to render maps with `osm-bright` style using the `maputnik` map editor as a frontend.

[docker]: https://www.docker.com/ 'docker'
[docker-compose]: https://docs.docker.com/compose/install/ 'docker-compose'
